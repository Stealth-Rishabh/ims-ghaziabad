<?php
function scan_for_malware($dir) {
    $malicious_patterns = [
        '/file_get_contents\s*\(\s*[\'"]https?:\/\/[^\'"]+[\'"]\s*\)/i',
        '/\$_SERVER\s*\[\s*[\'"]HTTP_USER_AGENT[\'"]\s*\]/i',
        '/eval\s*\(/i',
        '/base64_decode\s*\(/i',
        '/gzinflate\s*\(/i',
        '/shell_exec\s*\(/i',
        '/paste\.ee/i',
        '/preg_replace\s*\(\s*[\'"]\/.*\/e[\'"]\s*,/i'
    ];

    $rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir));

    foreach ($rii as $file) {
        if (!$file->isFile() || pathinfo($file, PATHINFO_EXTENSION) !== 'php') continue;

        $contents = file_get_contents($file->getPathname());
        foreach ($malicious_patterns as $pattern) {
            if (preg_match($pattern, $contents)) {
                echo "[!] Suspicious code in: " . $file->getPathname() . "\n";
                echo "    Pattern: " . $pattern . "\n\n";
                break;
            }
        }
    }
}

// Set to your website's root folder (e.g., public_html, htdocs, etc.)
$root_dir = __DIR__;
scan_for_malware($root_dir);
?>